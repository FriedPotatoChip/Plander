<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<mapper namespace="com.bit.mapper.AdminMapper">

	<!-- 회원List -->
	<select id="getUserList" resultType="com.bit.domain.UsersVO"
		parameterType="com.bit.utils.PagingVO">
		<![CDATA[
		select *    
    		from (select rownum rn, u_idx, id, name, phone, email, rank, regdate, zipno, roadAddrPart1, addrDetail from users)
    		where rn between #{start} and #{end}
    	]]>
	</select>

	<select id="getSearchList" resultType="com.bit.domain.UsersVO"
		parameterType="map">
		select *
		from (
		select rownum rn, u_idx, id, name, phone, email, rank, regdate, zipno,
		roadAddrPart1, addrDetail
		from users
		where
		<choose>
			<when test="target == 'id'.toString()">
				id like '%' || #{keyword} || '%'
			</when>

			<when test="target == 'name'.toString()">
				name like '%' || #{keyword} || '%'
			</when>
		</choose>
		)
		where rn between #{start} and #{end}
	</select>

	<select id="getSearchTotal" resultType="int" parameterType="map">
		select count(*) from users where
		<choose>
			<when test="target == 'id'.toString()">
				id like '%' || #{keyword} || '%'
			</when>

			<when test="target == 'name'.toString()">
				name like '%' || #{keyword} || '%'
			</when>
		</choose>
	</select>
	
	<!-- 전체 회원 수 -->
	<select id="getTotal" resultType="int">
		SELECT count(*) FROM USERS
	</select>

	<!-- 예약된 사물함 -->
	<select id="bookingCabinet"
		resultType="com.bit.domain.BookingCbVO">
		select *
		from booking_cb bc, cabinet c
		where c.cb_number =
		bc.cb_number
		and sysdate between bc.start_date and end_date
		and br_idx=
		#{br_idx}
	</select>

	<!-- 예약된 사물함 수 -->
	<select id="bookingCabinet_count" resultType="int">
		select
		count(bc.ckb_idx)
		from booking_cb bc, cabinet c
		where c.cb_number =
		bc.cb_number
		and sysdate between bc.start_date and end_date
		and br_idx=
		#{br_idx}
	</select>
	
	<!-- 회원삭제 -->
	<delete id="userDelete" parameterType="int">
		delete from users
			where u_idx = #{u_idx}
	</delete>
</mapper>



