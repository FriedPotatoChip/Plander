<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<mapper namespace="com.bit.mapper.MyMapper">

	<!-- 내정보 -->
	<select id="user" resultType="com.bit.domain.UsersVO">
		select * from users where id =
		#{id}
	</select>

	<!-- 전체 모집글 갯수 조회 --><!-- 페이징처리용 -->
	<select id="getTotal" resultType="int">
		select count(*) from recruit
		where id = #{id}
	</select>

	<!-- 전체 좌석 예약 갯수 조회 -->
	<select id="getTotalSeat" resultType="int">
		select count(*) from
		booking
		where id = #{id}
	</select>

	<!-- 전체 사물함 예약 갯수 조회 -->
	<select id="getTotalCabinet" resultType="int">
		select count(*) from
		booking_cb
		where id = #{id}
	</select>

	<!-- 내정보수정 -->
	<update id="userUpdate" parameterType="com.bit.domain.UsersVO">
		update users set password
		= #{password},
		name = #{name},
		phone = #{phone},
		email = #{email},
		zipNo =
		#{zipNo},
		roadAddrPart1 = #{roadAddrPart1},
		addrDetail = #{addrDetail}
		where id = #{id}
	</update>

	<!-- 모집글 작성 -->
	<insert id="insertRecruit"
		parameterType="com.bit.domain.RecruitVO">
		insert into recruit (rc_idx, rc_title, rc_content, id,
		max_mem)
		values (recruit_seq.nextval, #{rc_title}, #{rc_content},
		#{id}, #{max_mem})
	</insert>

	<!-- 내가 쓴 모집글 -->
	<!-- <select id="my_recruit" resultType="com.bit.domain.RecruitVO"> select 
		* from recruit where id = #{id} </select> -->

	<!-- 내가 쓴 모집글 페이징 처리용 -->
	<select id="my_recruit" resultType="com.bit.domain.RecruitVO"
		parameterType="Map">
		select * from
		(
		select rownum rn, rc.* from recruit rc
		where
		rc.id =
		#{id}
		order by
		rc_idx desc
		)
		where rn between #{start}
		and
		#{end}
	</select>

	<!-- 내가 쓴 모집글 상세 조회 -->
	<select id="getOne" resultType="com.bit.domain.RecruitVO">
		select * from recruit where
		rc_idx = #{rc_idx}
	</select>

	<!-- 내가 쓴 모집글 수정 -->
	<update id="updateRec" parameterType="com.bit.domain.RecruitVO">
		update recruit set rc_title
		= #{rc_title}, max_mem = #{max_mem}, rc_content = #{rc_content} where
		rc_idx = #{rc_idx}
	</update>

	<!-- 내가 쓴 모집글 삭제 -->
	<delete id="deleteRec" parameterType="int">
		delete from recruit where
		rc_idx = #{rc_idx}
	</delete>

	<!-- 내 모집글에 달린 댓글 -->
	<select id="my_recruit_comment"
		resultType="com.bit.domain.CommentsVO">
		select c.*, rc.*
		from comments c, recruit rc
		where c.rc_idx =
		rc.rc_idx
		and rc.id = #{id}
	</select>

	<!-- 모집글 댓글 등록 -->
	<insert id="insertComm"
		parameterType="com.bit.domain.CommentsVO">
		insert into comments (c_idx, c_content, id, rc_idx)
		values (comments_seq.nextval, #{c_content}, #{id}, #{rc_idx})
	</insert>

	<!-- 내 모집글의 신청자 목록 조회 -->
	<select id="getApplyList" resultType="com.bit.domain.ApplyVO">
		select a.*, rc.*
		from apply
		a, recruit rc
		where a.rc_idx = rc.rc_idx
		and rc.rc_idx = (select rc_idx
		from recruit where id = 'test')
	</select>

	<!-- 내 좌석 예약내역 -->
	<select id="my_seat" resultType="com.bit.domain.BookingVO">
		select b.*, s.*
		from booking b,
		seats_view s
		where b.s_idx = s.s_idx
		and b.id = #{id}
	</select>

	<!-- 내 사물함 예약내역 -->
	<select id="my_cabinet" resultType="com.bit.domain.BookingCbVO">
		select b.*, c.*, br.br_name
		from booking_cb b, cabinet c, branches br
		where b.cb_idx =
		c.cb_idx
		and c.br_idx = br.br_idx
		and b.id = #{id}
	</select>

	<!-- 자유게시판에 올린 글목록 -->
	<!-- <select id="board" resultType="com.bit.domain.BoardVO"> select * from 
		board where ct_idx = 2 and id = #{id} </select> -->

	<!-- 자유게시판에 올린 글목록 갯수 페이징용 -->
	<select id="board_cnt" resultType="int">
		select count(*) from
		board
		where ct_idx = 2 and id = #{id}
	</select>

	<!-- 자유게시판에 올린 글목록 페이징용 -->
	<select id="board" resultType="com.bit.domain.BoardVO"
		parameterType="Map">
		select * from
		(
		select rownum rn, b.* from board b
		where
		ct_idx = 2
		and id = #{id}
		order by
		b_idx desc
		)
		where rn between #{start}
		and
		#{end}
	</select>

	<!-- 자유게시판에 달린 댓글목록 -->
	<!-- <select id="board_comment" resultType="com.bit.domain.CommentsVO"> 
		select c.*, b.* from comments c, board b where c.b_idx = b.b_idx and b.ct_idx 
		= 2 and b.id = #{id} </select> -->

	<!-- 자유게시판에 달린 댓글목록 페이징용 -->
	<select id="board_comment"
		resultType="com.bit.domain.CommentsVO" parameterType="Map">
		select *
		from(
		select rownum rn, b.b_idx, b.b_title, b.id, b.ct_idx, b.b_regdate,
		c.c_idx,
		c.c_regdate
		from board b, comments c
		where c.b_idx = b.b_idx
		and
		b.ct_idx = 2
		and b.id = #{id}
		order by c_idx desc
		)
		where rn between
		#{start} and #{end}
	</select>

	<!-- 자유게시판에 달린 댓글목록 갯수 페이징용 -->
	<select id="board_comment_cnt" resultType="int">
		select count(*)
		from
		comments c, board b
		where c.b_idx =
		b.b_idx
		and b.ct_idx = 2
		and b.id =
		#{id}
	</select>

	<!-- 자유게시판 상세보기 -->
	<select id="getBoardOne" resultType="com.bit.domain.BoardVO">
		select * from board where
		ct_idx = 2
		and b_idx = #{b_idx}
	</select>
	
	<!-- 프로필 사진 업데이트 -->
	<update id="updateProfileImg" parameterType="com.bit.domain.UsersVO">
		UPDATE USERS SET USER_PROFILEIMAGEPATH = #{user_profileImagePath} WHERE U_IDX = #{u_idx}
	</update>
	
	
	
	
</mapper>