<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<mapper namespace="com.bit.mapper.MyMapper">

	<!-- 내정보 -->
	<select id="user" resultType="com.bit.domain.UsersVO">
		select * from users where id =
		#{id}
	</select>

	<!-- 내정보수정 -->
	<update id="userUpdate" parameterType="com.bit.domain.UsersVO">
		update users set password
		= #{password},
		name = #{name},
		phone = #{phone},
		email = #{email},
		zipNo =
		#{zipNo},
		roadAddrPart1 = #{roadAddrPart1},
		addrDetail = #{addrDetail}
		where id = #{id}
	</update>

	<!-- 모집글 작성 -->
	<insert id="insertRecruit"
		parameterType="com.bit.domain.RecruitVO">
		insert into recruit (rc_idx, rc_title, rc_content, id,
		max_mem)
		values (recruit_seq.nextval, #{rc_title}, #{rc_content},
		#{id}, #{max_mem})
	</insert>

	<!-- 내가 쓴 모집글 -->
	<select id="my_recruit" resultType="com.bit.domain.RecruitVO">
		select * from recruit where
		id = #{id}
	</select>

	<!-- 내가 쓴 모집글 상세 조회 -->
	<select id="getOne" resultType="com.bit.domain.RecruitVO">
		select * from recruit where
		rc_idx = #{rc_idx}
	</select>

	<!-- 내가 쓴 모집글 수정 -->
	<update id="updateRec" parameterType="com.bit.domain.RecruitVO">
		update recruit set rc_title
		= #{rc_title}, max_mem = #{max_mem}, rc_content = #{rc_content} where
		rc_idx = #{rc_idx}
	</update>

	<!-- 내가 쓴 모집글 삭제 -->
	<delete id="deleteRec" parameterType="int">
		delete from recruit where
		rc_idx = #{rc_idx}
	</delete>

	<!-- 내 모집글에 달린 댓글 -->
	<select id="my_recruit_comment"
		resultType="com.bit.domain.CommentsVO">
		select c.*, rc.*
		from comments c, recruit rc
		where c.rc_idx =
		rc.rc_idx
		and rc.id = #{id}
	</select>

	<!-- 모집글 댓글 등록 -->
	<insert id="insertComm"
		parameterType="com.bit.domain.CommentsVO">
		insert into comments (c_idx, c_content, id, rc_idx)
		values (comments_seq.nextval, #{c_content}, #{id}, #{rc_idx})
	</insert>

	<!-- 내 모집글의 신청자 목록 조회 -->
	<select id="getApplyList" resultType="com.bit.domain.ApplyVO">
		select a.*, rc.*
		from apply a, recruit rc
		where a.rc_idx = rc.rc_idx
		and rc.rc_idx = (select rc_idx from recruit where id = 'test')
	</select>

	<!-- 내 좌석 예약내역 -->
	<select id="my_seat" resultType="com.bit.domain.BookingVO">
		select b.*, s.*
		from booking b,
		seats_view s
		where b.s_idx = s.s_idx
		and b.id = #{id}
	</select>

	<!-- 내 사물함 예약내역 -->
	<select id="my_cabinet" resultType="com.bit.domain.BookingCbVO">
		select b.*, c.*, br.br_name
		from booking_cb b, cabinet c, branches br
		where b.cb_number =
		c.cb_number
		and c.br_idx = br.br_idx
		and b.id = #{id}
	</select>

</mapper>